# üé• Camera Device Busy - ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

## ‚ùå ‡∏õ‡∏±‡∏ç‡∏´‡∏≤

```
ERROR V4L2 v4l2_device.cpp:390 'imx708': Unable to set controls: Device or resource busy
Pipeline handler in use by another process
RuntimeError: Failed to acquire camera: Device or resource busy
```

**‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢**: ‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏î‡πâ

---

## ‚úÖ ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏á‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡∏¢‡∏≤‡∏Å)

### ‡∏ß‡∏¥‡∏ò‡∏µ 1: ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á (‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î) ‚≠ê ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
```bash
python3 release_camera_pi5.py
```

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà:
```bash
python3 phase2_live_inference_pi5.py
```

---

### ‡∏ß‡∏¥‡∏ò‡∏µ 2: ‡πÉ‡∏ä‡πâ auto-restart script
```bash
bash run_inference_pi5.sh
```

‡∏°‡∏±‡∏ô‡∏à‡∏∞:
1. ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ inference
2. ‡∏ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á
3. ‡∏£‡∏≠ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
4. ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

---

### ‡∏ß‡∏¥‡∏ò‡∏µ 3: Kill ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á
```bash
# ‡∏´‡∏≤‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á
lsof /dev/video0

# Kill ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ (‡πÅ‡∏ó‡∏ô PID ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç)
kill -9 <PID>

# ‡∏´‡∏£‡∏∑‡∏≠ kill ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
pkill -f "python3"
pkill -f "libcamera"
```

---

### ‡∏ß‡∏¥‡∏ò‡∏µ 4: Reboot (‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î)
```bash
sudo reboot
```

‡∏à‡∏≤‡∏Å‡∏ô‡∏±‡πâ‡∏ô‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà:
```bash
python3 phase2_live_inference_pi5.py
```

---

## üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£

```bash
# ‡∏î‡∏π‡∏ß‡πà‡∏≤‡∏°‡∏µ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏≠‡∏∑‡πà‡∏ô‡πÉ‡∏ä‡πâ‡∏Å‡∏•‡πâ‡∏≠‡∏á
ps aux | grep -i camera
ps aux | grep -i libcamera
ps aux | grep -i python

# ‡∏î‡∏π‡∏à‡∏≥‡∏ô‡∏ß‡∏ô processes
ps aux | wc -l

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏•‡πâ‡∏≠‡∏á
libcamera-hello --list-cameras
```

---

## üö® ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á?

‡∏ñ‡πâ‡∏≤ release_camera_pi5.py ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ú‡∏•:

### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö GPU memory
```bash
vcgencmd measure_clock gpu
vcgencmd measure_temp
```

### 2. ‡∏î‡∏π‡∏à‡∏≥‡∏ô‡∏ß‡∏ô file descriptors ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î
```bash
lsof | wc -l
```

### 3. Clear buffers
```bash
sudo sync
echo 3 | sudo tee /proc/sys/vm/drop_caches
```

### 4. Reboot ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏´‡∏ô‡∏±‡∏Å
```bash
sudo reboot -f
```

---

## üõ†Ô∏è ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏ã‡πâ‡∏≥

### 1. ‡πÉ‡∏ä‡πâ finally block ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î
```python
try:
    # inference code
finally:
    camera.release()  # ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÄ‡∏™‡∏°‡∏≠
```

### 2. ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ interrupt ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á inference
```bash
# ‡πÉ‡∏ä‡πâ nohup ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ interrupt
nohup python3 phase2_live_inference_pi5.py &

# ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ Ctrl+C ‡πÅ‡∏ö‡∏ö‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á
# ‡πÉ‡∏ä‡πâ Ctrl+C ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏≠‡πà‡∏≠‡∏ô (‡∏™‡πà‡∏ß‡∏ô‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏à‡∏∞ handle graceful shutdown)
```

### 3. Check camera ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°
```bash
python3 test_camera_pi5.py  # ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠
```

---

## üìä ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ Recovery

Script `run_inference_pi5.sh` ‡∏à‡∏∞:
- ‚úÖ Retry 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- ‚úÖ Release camera ‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£ retry
- ‚úÖ ‡∏£‡∏≠‡πÄ‡∏ß‡∏•‡∏≤ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
- ‚úÖ ‡∏ö‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡πâ‡∏≤ fail

```bash
bash run_inference_pi5.sh
```

---

## üìù ‡∏™‡∏£‡∏∏‡∏õ

| ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ | ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ |
|--------|--------|
| Camera busy ‡πÅ‡∏ô‡∏ß 1 | `python3 release_camera_pi5.py` |
| Camera busy ‡πÅ‡∏ô‡∏ß 2 | `bash run_inference_pi5.sh` |
| Camera busy ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏´‡∏≤‡∏¢ | `sudo reboot` |
| Process ‡∏ï‡∏¥‡∏î | `pkill -f python3` |
| GPU hung | `sudo reboot -f` |

**‡∏á‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î**: `python3 release_camera_pi5.py` ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà üé•
